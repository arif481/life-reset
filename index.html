<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Reset: Recovery & Growth Platform</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/tracker.css">
    <link rel="stylesheet" href="css/journal.css">
    <link rel="stylesheet" href="css/analytics.css">
    <link rel="stylesheet" href="css/gamification.css">
    <link rel="stylesheet" href="css/goals.css">
    <link rel="stylesheet" href="css/settings.css">
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Life Reset</h1>
                <p>Your Personal Recovery & Growth Platform</p>
            </div>

            <div id="authMessage"></div>

            <!-- Login Form -->
            <div id="loginForm">
                <form onsubmit="login(); return false;">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Password" autocomplete="current-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>

                <div class="auth-divider"><span>OR</span></div>

                <button class="btn btn-block" style="background: #4285f4; color: white;" onclick="googleSignIn()">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
                <button class="btn btn-secondary btn-block" onclick="guestSignIn()">
                    <i class="fas fa-user-secret"></i> Continue as Guest
                </button>

                <p style="text-align: center; margin-top: 15px; font-size: 14px;">
                    Don't have an account? <a href="#" onclick="showSignup(); return false;" style="color: var(--primary); text-decoration: none; font-weight: 600;">Sign up</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" style="display: none;">
                <form onsubmit="signup(); return false;">
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" class="form-control" placeholder="Your name" autocomplete="name" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" class="form-control" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" class="form-control" placeholder="At least 6 characters" autocomplete="new-password" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPasswordConfirm">Confirm Password</label>
                        <input type="password" id="signupPasswordConfirm" class="form-control" placeholder="Confirm password" autocomplete="new-password" minlength="6" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>

                <p style="text-align: center; margin-top: 15px; font-size: 14px;">
                    Already have an account? <a href="#" onclick="showLogin(); return false;" style="color: var(--primary); text-decoration: none; font-weight: 600;">Login</a>
                </p>
            </div>

            <div class="loading" id="authLoading">
                <div class="spinner"></div>
                <p>Authenticating...</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-leaf"></i> Life Reset</h2>
            </div>
            <div class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="navigateTo('dashboard')">
                    <i class="fas fa-chart-line"></i> <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('tracker')">
                    <i class="fas fa-check-square"></i> <span>Daily Tracker</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('mood')">
                    <i class="fas fa-smile"></i> <span>Mood & Journal</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('analytics')">
                    <i class="fas fa-chart-bar"></i> <span>Analytics</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('goals')">
                    <i class="fas fa-bullseye"></i> <span>Goals</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('resources')">
                    <i class="fas fa-phone"></i> <span>Resources</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('settings')">
                    <i class="fas fa-cog"></i> <span>Settings</span>
                </a>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-secondary btn-block" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileSidebar()" title="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button class="dark-mode-toggle" id="darkModeToggle" onclick="toggleDarkMode()" title="Toggle dark mode">üåô</button>
                    <div class="user-menu">
                        <button class="user-btn" onclick="toggleUserMenu()">
                            <i class="fas fa-user-circle"></i> <span id="userName">User</span>
                        </button>
                        <div class="dropdown" id="userDropdown">
                            <div class="dropdown-item" onclick="navigateTo('settings')">
                                <i class="fas fa-cog"></i> Settings
                            </div>
                            <button class="dropdown-item danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view"></div>

            <!-- Tracker View -->
            <div id="tracker-view" style="display: none;"></div>

            <!-- Mood & Journal View -->
            <div id="mood-view" style="display: none;"></div>

            <!-- Journal View -->
            <div id="journal-view" style="display: none;"></div>

            <!-- Analytics View -->
            <div id="analytics-view" style="display: none;"></div>

            <!-- Resources View -->
            <div id="resources-view" style="display: none;"></div>

            <!-- Goals View -->
            <div id="goals-view" style="display: none;"></div>

            <!-- Settings View -->
            <div id="settings-view" style="display: none;"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle" id="toastIcon"></i>
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <!-- Achievement Unlock Popup -->
    <div class="achievement-unlock-popup" id="achievementPopup">
        <h2>üéâ Achievement Unlocked!</h2>
        <div class="icon" id="popupIcon"></div>
        <p><strong id="popupTitle">Title</strong></p>
        <p id="popupDesc">Description</p>
    </div>

    <!-- Add Task Modal -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Custom Task</h3>
                <button class="modal-close" onclick="closeAddTaskModal()">√ó</button>
            </div>
            <div class="form-group">
                <label for="customTaskName">Task Name</label>
                <input type="text" id="customTaskName" class="form-control" placeholder="Enter task name">
            </div>
            <div class="form-group">
                <label for="taskCategory">Category</label>
                <select id="taskCategory" class="form-control">
                    <option value="morning">Morning Routine</option>
                    <option value="health">Health & Wellness</option>
                    <option value="productivity">Productivity</option>
                    <option value="evening">Evening Routine</option>
                    <option value="custom">Custom Tasks</option>
                </select>
            </div>
            <button class="btn btn-primary btn-block" onclick="addCustomTask()">
                <i class="fas fa-plus"></i> Add Task
            </button>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- JavaScript Modules -->
    <script src="js/app-state.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/gamification.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/mood-journal.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/goals.js"></script>
    <script src="js/data-loader.js"></script>
    
    <!-- Fallback Views Script -->
    <script>
        // Initialize fallback views
        document.addEventListener('DOMContentLoaded', () => {
            initFallbackViews();
        });

        function initFallbackViews() {
            document.getElementById('dashboard-view').innerHTML = `
                <div class="section">
                    <h2>üìä Dashboard</h2>
                    <div class="dashboard-grid">
                        <div class="card stat-card">
                            <div class="stat-number" id="levelBadge">1</div>
                            <div class="stat-label">Current Level</div>
                            <div class="stat-icon"><i class="fas fa-star"></i></div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-number" id="taskCompletionStat">0%</div>
                            <div class="stat-label">Task Completion</div>
                            <div class="stat-icon"><i class="fas fa-check"></i></div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-number" id="journalEntriesStat">0</div>
                            <div class="stat-label">Journal Entries</div>
                            <div class="stat-icon"><i class="fas fa-book"></i></div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-number" id="consistencyStat">0%</div>
                            <div class="stat-label">Consistency</div>
                            <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h2>üîã XP & Level Progress</h2>
                    <div class="level-badge" style="display: inline-flex;">1</div>
                    <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
                    <p id="xpText">0/100 XP</p>
                </div>
                <div class="section">
                    <h2>üèÜ Badges Earned</h2>
                    <div class="badge-container" id="badgesContainer"></div>
                </div>
                <div class="section">
                    <h2>üéØ Health Score</h2>
                    <div class="health-score-circle">
                        <div class="health-score-value" id="healthScore">0</div>
                        <div class="health-score-label">Overall Health</div>
                    </div>
                    <div class="stats-grid-mini">
                        <div class="stat-mini">
                            <div class="stat-mini-value" id="streakDays">0 Days</div>
                            <div class="stat-mini-label">Current Streak</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('tracker-view').innerHTML = `
                <div class="section">
                    <h2>üìã Daily Tracker</h2>
                    <div class="date-selector">
                        <button class="date-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
                        <span class="current-date" id="currentDate">Today</span>
                        <button class="date-btn" onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div class="progress-bar"><div class="progress-fill" id="todayProgress"></div></div>
                        <p id="progressText">0% of today's tasks completed</p>
                    </div>
                    <div id="taskCategories"></div>
                    <button class="btn btn-primary" onclick="showAddTaskModal()"><i class="fas fa-plus"></i> Add Custom Task</button>
                </div>
            `;

            document.getElementById('mood-view').innerHTML = `
                <div class="mood-section">
                    <h2>üòä How are you feeling?</h2>
                    <div class="mood-tracker">
                        <button class="mood-btn" onclick="selectMood('very-sad')"><span>üò¢</span><span class="mood-label">Very Sad</span></button>
                        <button class="mood-btn" onclick="selectMood('sad')"><span>üòû</span><span class="mood-label">Sad</span></button>
                        <button class="mood-btn" onclick="selectMood('okay')"><span>üòê</span><span class="mood-label">Okay</span></button>
                        <button class="mood-btn" onclick="selectMood('good')"><span>üòä</span><span class="mood-label">Good</span></button>
                        <button class="mood-btn" onclick="selectMood('great')"><span>üòÑ</span><span class="mood-label">Great</span></button>
                    </div>
                    <textarea class="textarea" id="moodNote" placeholder="Add a note about your mood..."></textarea>
                    <button class="btn btn-primary" onclick="saveMoodEntry()"><i class="fas fa-save"></i> Save Mood</button>
                </div>
            `;

            document.getElementById('journal-view').innerHTML = `
                <div class="section">
                    <h2>üìñ Journal</h2>
                    <div class="journal-container">
                        <div class="journal-editor">
                            <h3>Write Your Thoughts</h3>
                            <textarea class="textarea" id="journalEntry" placeholder="Write what's on your mind..."></textarea>
                            <button class="btn btn-primary" onclick="saveJournalEntry()"><i class="fas fa-save"></i> Save Entry</button>
                        </div>
                        <div class="journal-history" id="journalHistory">
                            <h3>Recent Entries</h3>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('analytics-view').innerHTML = `
                <div class="analytics-grid">
                    <div class="chart-container"><canvas id="moodChart"></canvas></div>
                    <div class="chart-container"><canvas id="completionChart"></canvas></div>
                </div>
                <div class="section">
                    <h2>üìà Insights</h2>
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-value" id="bestTaskInsight">---</div>
                            <div class="insight-label">Best Category</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="moodImpactInsight">---</div>
                            <div class="insight-label">Mood Score</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-value" id="consistencyInsight">---</div>
                            <div class="insight-label">Consistency</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('goals-view').innerHTML = `
                <div class="section">
                    <h2><i class="fas fa-bullseye"></i> Goals & Habits</h2>
                    <button class="btn btn-primary" onclick="showAddGoalModal()" style="margin-bottom: 15px;"><i class="fas fa-plus"></i> Add New Goal</button>
                    <div id="goalsContainer" style="margin-top: 20px;"></div>
                </div>
                <div class="section">
                    <h2><i class="fas fa-fire"></i> 30-Day Habit Chain</h2>
                    <div id="habitChain" style="margin-top: 15px;"></div>
                </div>
            `;

            document.getElementById('resources-view').innerHTML = `
                <div class="section">
                    <h2>üÜò Crisis Resources</h2>
                    <div class="resources-grid">
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-phone"></i></div>
                            <h3 class="resource-title">National Suicide Prevention Lifeline</h3>
                            <p class="resource-desc">Free, confidential support 24/7</p>
                            <div class="emergency-contact">üìû 1-800-273-8255</div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-message"></i></div>
                            <h3 class="resource-title">Crisis Text Line</h3>
                            <p class="resource-desc">Text HOME to 741741</p>
                            <div class="emergency-contact">üí¨ Text HOME to 741741</div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-users"></i></div>
                            <h3 class="resource-title">SAMHSA National Helpline</h3>
                            <p class="resource-desc">Substance abuse & mental health services</p>
                            <div class="emergency-contact">üìû 1-800-662-4357</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('settings-view').innerHTML = `
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-title">Preferences</div>
                        <div class="setting-group">
                            <div class="toggle-label">
                                <span>Dark Mode</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" onchange="toggleDarkModeSetting()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="setting-card">
                        <div class="setting-title">Account</div>
                        <p><strong>Name:</strong> <span id="userName">User</span></p>
                        <p><strong>Email:</strong> <span id="userEmail">user@example.com</span></p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
