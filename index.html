<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="theme-color" content="#4361ee">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Life Reset">
    <meta name="description" content="Personal Recovery & Growth Platform - Track habits, mood, and goals">
    <meta name="format-detection" content="telephone=no">
    <title>Life Reset: Recovery & Growth Platform</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="data:,">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/tracker.css">
    <link rel="stylesheet" href="css/journal.css">
    <link rel="stylesheet" href="css/analytics.css">
    <link rel="stylesheet" href="css/gamification.css">
    <link rel="stylesheet" href="css/goals.css">
    <link rel="stylesheet" href="css/habits.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/mobile.css">
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[SW] Registered:', registration.scope);
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000); // Every hour
                    })
                    .catch(error => {
                        console.log('[SW] Registration failed:', error);
                    });
            });
        }
        
        // Initialize native Google Auth plugin on Android
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.GoogleAuth) {
                window.Capacitor.Plugins.GoogleAuth.initialize();
                console.log('[GoogleAuth] Native plugin initialized');
            }
        });
    </script>
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Life Reset</h1>
                <p>Your Personal Recovery & Growth Platform</p>
            </div>

            <div id="authMessage"></div>

            <!-- Login Form -->
            <div id="loginForm">
                <form onsubmit="login(); return false;">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Password" autocomplete="current-password" required>
                        <a href="#" onclick="showForgotPassword(); return false;" style="display: block; text-align: right; margin-top: 8px; font-size: 13px; color: var(--primary); text-decoration: none;">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>

                <div class="auth-divider"><span>OR</span></div>

                <button id="googleSignInBtn" class="btn btn-block" style="background: #4285f4; color: white;" onclick="googleSignIn()">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
                <button class="btn btn-secondary btn-block" onclick="guestSignIn()">
                    <i class="fas fa-user-secret"></i> Continue as Guest
                </button>

                <p style="text-align: center; margin-top: 15px; font-size: 14px;">
                    Don't have an account? <a href="#" onclick="showSignup(); return false;" style="color: var(--primary); text-decoration: none; font-weight: 600;">Sign up</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" style="display: none;">
                <form onsubmit="signup(); return false;">
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" class="form-control" placeholder="Your name" autocomplete="name" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" class="form-control" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" class="form-control" placeholder="At least 6 characters" autocomplete="new-password" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPasswordConfirm">Confirm Password</label>
                        <input type="password" id="signupPasswordConfirm" class="form-control" placeholder="Confirm password" autocomplete="new-password" minlength="6" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>

                <p style="text-align: center; margin-top: 15px; font-size: 14px;">
                    Already have an account? <a href="#" onclick="showLogin(); return false;" style="color: var(--primary); text-decoration: none; font-weight: 600;">Login</a>
                </p>
            </div>

            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px;"><i class="fas fa-key"></i> Reset Password</h3>
                <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 14px;">
                    Enter your email address and we'll send you a link to reset your password.
                </p>
                <form onsubmit="resetPassword(); return false;">
                    <div class="form-group">
                        <label for="resetEmail">Email</label>
                        <input type="email" id="resetEmail" class="form-control" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-paper-plane"></i> Send Reset Link
                    </button>
                </form>
                <p style="text-align: center; margin-top: 15px; font-size: 14px;">
                    <a href="#" onclick="showLogin(); return false;" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fas fa-arrow-left"></i> Back to Login</a>
                </p>
            </div>

            <div class="loading" id="authLoading">
                <div class="spinner"></div>
                <p>Authenticating...</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Mobile Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-leaf"></i> Life Reset</h2>
            </div>
            <div class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="navigateTo('dashboard')">
                    <i class="fas fa-chart-line"></i> <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('tracker')">
                    <i class="fas fa-check-square"></i> <span>Daily Tracker</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('mood')">
                    <i class="fas fa-smile"></i> <span>Mood & Journal</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('analytics')">
                    <i class="fas fa-chart-bar"></i> <span>Analytics</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('goals')">
                    <i class="fas fa-bullseye"></i> <span>Goals</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('resources')">
                    <i class="fas fa-phone"></i> <span>Resources</span>
                </a>
                <a href="#" class="nav-item" onclick="navigateTo('settings')">
                    <i class="fas fa-cog"></i> <span>Settings</span>
                </a>
            </div>
            <div class="sidebar-footer">
                <button class="btn btn-secondary btn-block" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileSidebar()" title="Toggle menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button class="dark-mode-toggle" id="darkModeToggle" onclick="toggleDarkMode()" title="Toggle dark mode">üåô</button>
                    <div class="user-menu">
                        <button class="user-btn" onclick="toggleUserMenu()">
                            <i class="fas fa-user-circle"></i> <span id="userName">User</span>
                        </button>
                        <div class="dropdown" id="userDropdown">
                            <div class="dropdown-item" onclick="navigateTo('settings')">
                                <i class="fas fa-cog"></i> Settings
                            </div>
                            <button class="dropdown-item danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view"></div>

            <!-- Tracker View -->
            <div id="tracker-view" style="display: none;"></div>

            <!-- Mood & Journal View -->
            <div id="mood-view" style="display: none;"></div>

            <!-- Journal View -->
            <div id="journal-view" style="display: none;"></div>

            <!-- Analytics View -->
            <div id="analytics-view" style="display: none;"></div>

            <!-- Resources View -->
            <div id="resources-view" style="display: none;"></div>

            <!-- Goals View -->
            <div id="goals-view" style="display: none;"></div>

            <!-- Settings View -->
            <div id="settings-view" style="display: none;"></div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle" id="toastIcon"></i>
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <!-- Achievement Unlock Popup -->
    <div class="achievement-unlock-popup" id="achievementPopup">
        <h2>üéâ Achievement Unlocked!</h2>
        <div class="icon" id="popupIcon"></div>
        <p><strong id="popupTitle">Title</strong></p>
        <p id="popupDesc">Description</p>
    </div>

    <!-- Add Task Modal -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Custom Task</h3>
                <button class="modal-close" onclick="closeAddTaskModal()">√ó</button>
            </div>
            <div class="form-group">
                <label for="customTaskName">Task Name</label>
                <input type="text" id="customTaskName" class="form-control" placeholder="Enter task name">
            </div>
            <div class="form-group">
                <label for="taskCategory">Category</label>
                <select id="taskCategory" class="form-control">
                    <option value="morning">Morning Routine</option>
                    <option value="health">Health & Wellness</option>
                    <option value="productivity">Productivity</option>
                    <option value="evening">Evening Routine</option>
                    <option value="custom">Custom Tasks</option>
                </select>
            </div>
            <button class="btn btn-primary btn-block" onclick="addCustomTask()">
                <i class="fas fa-plus"></i> Add Task
            </button>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="firebase-config.js"></script>
    
    <!-- JavaScript Modules -->
    <script src="js/app-state.js"></script>
    <script src="js/offline-manager.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/gamification.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/mood-journal.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/goals.js"></script>
    <script src="js/habits.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/dashboard.js"></script>
    
    <!-- Fallback Views Script -->
    <script>
        // Initialize fallback views
        document.addEventListener('DOMContentLoaded', () => {
            initFallbackViews();
        });

        function initFallbackViews() {
            document.getElementById('dashboard-view').innerHTML = `
                <div class="section">
                    <h2>üìä Advanced Dashboard</h2>
                    <div id="dashboardOverview"></div>
                </div>
                
                <div class="section">
                    <div id="dashboardWeeklyActivityChart"></div>
                </div>
                
                <div class="section">
                    <div id="dashboardMoodTrendChart"></div>
                </div>
                
                <div class="section">
                    <div id="habitCompletionChart"></div>
                </div>
                
                <div class="section">
                    <div id="categoryBreakdown"></div>
                </div>
                
                <div class="section">
                    <div id="quickStats"></div>
                </div>
                
                <div class="section">
                    <div id="recentActivity"></div>
                </div>
                
                <div class="section">
                    <div id="insights"></div>
                </div>
                
                <div class="section">
                    <div id="milestones"></div>
                </div>
            `;

            document.getElementById('tracker-view').innerHTML = `
                <div class="section">
                    <h2>üìã Daily Tracker</h2>
                    <div class="date-selector">
                        <button class="date-btn" onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
                        <span class="current-date" id="currentDate">Today</span>
                        <button class="date-btn" onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div class="progress-bar"><div class="progress-fill" id="todayProgress"></div></div>
                        <p id="progressText">0% of today's tasks completed</p>
                    </div>
                    <div id="taskCategories"></div>
                    <button class="btn btn-primary" onclick="showAddTaskModal()"><i class="fas fa-plus"></i> Add Custom Task</button>
                </div>
            `;

            document.getElementById('mood-view').innerHTML = `
                <div class="mood-section">
                    <h2>üòä How are you feeling today?</h2>
                    <div class="mood-tracker">
                        <button class="mood-btn" onclick="selectMood('very-sad', event)" data-mood="very-sad" title="Very Sad"><span>üò¢</span><span class="mood-label">Very Sad</span></button>
                        <button class="mood-btn" onclick="selectMood('sad', event)" data-mood="sad" title="Sad"><span>üòû</span><span class="mood-label">Sad</span></button>
                        <button class="mood-btn" onclick="selectMood('okay', event)" data-mood="okay" title="Okay"><span>üòê</span><span class="mood-label">Okay</span></button>
                        <button class="mood-btn" onclick="selectMood('good', event)" data-mood="good" title="Good"><span>üòä</span><span class="mood-label">Good</span></button>
                        <button class="mood-btn" onclick="selectMood('great', event)" data-mood="great" title="Great"><span>üòÑ</span><span class="mood-label">Great</span></button>
                    </div>

                    <div class="mood-intensity">
                        <div class="intensity-label">
                            <span>Intensity Level</span>
                            <span id="intensityValue">50%</span>
                        </div>
                        <input type="range" id="moodIntensity" class="intensity-slider" min="0" max="100" value="50" oninput="updateIntensityDisplay()">
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px;">What triggered this mood?</h3>
                    <div class="mood-triggers">
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'work')">üíº Work</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'relationships')">üíë Relationships</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'health')">üè• Health</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'finances')">üí∞ Finances</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'social')">üë• Social</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'sleep')">üò¥ Sleep</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'exercise')">üèÉ Exercise</div>
                        <div class="trigger-tag" onclick="toggleTrigger(this, 'food')">üçΩÔ∏è Food</div>
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px;">Mood Notes</h3>
                    <textarea class="textarea" id="moodNote" placeholder="Add a note about your mood, what happened, what you're thinking..."></textarea>
                    <button class="btn btn-primary" onclick="saveMoodEntry()" style="margin-top: 15px;"><i class="fas fa-save"></i> Save Mood</button>
                </div>

                <div class="mood-trends">
                    <h2>üìä Your Mood Trends</h2>
                    <div class="mood-stats">
                        <div class="mood-stat-card">
                            <div class="mood-stat-value" id="averageMood">--</div>
                            <div class="mood-stat-label">Today's Average</div>
                        </div>
                        <div class="mood-stat-card">
                            <div class="mood-stat-value" id="bestMood">üòÑ</div>
                            <div class="mood-stat-label">Best Mood This Week</div>
                        </div>
                        <div class="mood-stat-card">
                            <div class="mood-stat-value" id="moodStreak">0</div>
                            <div class="mood-stat-label">Logging Streak</div>
                        </div>
                        <div class="mood-stat-card">
                            <div class="mood-stat-value" id="commonTrigger">--</div>
                            <div class="mood-stat-label">Common Trigger</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('journal-view').innerHTML = `
                <div class="section">
                    <h2>üìñ Journal</h2>
                    <div class="journal-container">
                        <div class="journal-editor">
                            <h3>Write Your Thoughts</h3>
                            <div class="editor-toolbar">
                                <button class="toolbar-btn" onclick="formatText('bold')" title="Bold"><b>B</b></button>
                                <button class="toolbar-btn" onclick="formatText('italic')" title="Italic"><i>I</i></button>
                                <button class="toolbar-btn" onclick="formatText('underline')" title="Underline"><u>U</u></button>
                                <span style="margin: 0 5px; opacity: 0.3;">|</span>
                                <input type="color" id="textColor" class="toolbar-btn" onchange="formatText('color')" title="Text Color" style="width: 40px; padding: 2px; cursor: pointer;">
                            </div>
                            <textarea class="textarea" id="journalEntry" placeholder="Write what's on your mind..." style="min-height: 200px;"></textarea>
                            
                            <div style="margin-top: 15px;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500;">Add Tags</label>
                                <input type="text" id="journalTags" placeholder="E.g., #motivation #growth #challenge (press Enter to add)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                                <div class="entry-tags" id="journalTagsDisplay"></div>
                            </div>

                            <div style="margin-top: 15px;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500;">Mood for this entry</label>
                                <div class="mood-tracker" style="gap: 5px;">
                                    <button class="mood-btn" onclick="selectJournalMood('very-sad', event)" data-mood="very-sad" style="min-width: auto; padding: 10px;"><span>üò¢</span></button>
                                    <button class="mood-btn" onclick="selectJournalMood('sad', event)" data-mood="sad" style="min-width: auto; padding: 10px;"><span>üòû</span></button>
                                    <button class="mood-btn" onclick="selectJournalMood('okay', event)" data-mood="okay" style="min-width: auto; padding: 10px;"><span>üòê</span></button>
                                    <button class="mood-btn" onclick="selectJournalMood('good', event)" data-mood="good" style="min-width: auto; padding: 10px;"><span>üòä</span></button>
                                    <button class="mood-btn" onclick="selectJournalMood('great', event)" data-mood="great" style="min-width: auto; padding: 10px;"><span>üòÑ</span></button>
                                </div>
                            </div>

                            <button class="btn btn-primary" onclick="saveJournalEntry()" style="margin-top: 15px; width: 100%;"><i class="fas fa-save"></i> Save Entry</button>
                        </div>
                        <div class="journal-history" id="journalHistory">
                            <h3>Recent Entries</h3>
                            <div class="filter-controls" style="margin-top: 15px;">
                                <button class="filter-btn active" onclick="filterJournalEntries('all', this)">All</button>
                                <button class="filter-btn" onclick="filterJournalEntries('week', this)">This Week</button>
                                <button class="filter-btn" onclick="filterJournalEntries('month', this)">This Month</button>
                                <input type="text" id="journalSearch" placeholder="Search entries..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; flex: 1; max-width: 200px;">
                            </div>
                            <div id="journalEntriesContainer" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('analytics-view').innerHTML = `
                <!-- Analytics Header -->
                <div class="analytics-header">
                    <h1><i class="fas fa-chart-line"></i> Analytics & Insights</h1>
                    <div class="time-range-controls">
                        <button class="time-range-btn active" onclick="changeTimeRange('7days')">7 Days</button>
                        <button class="time-range-btn" onclick="changeTimeRange('30days')">30 Days</button>
                        <button class="time-range-btn" onclick="changeTimeRange('90days')">90 Days</button>
                        <button class="time-range-btn" onclick="changeTimeRange('all')">All Time</button>
                    </div>
                </div>

                <!-- Statistics Overview -->
                <div class="analytics-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-star"></i></div>
                        <div class="stat-label">Total XP</div>
                        <div class="stat-value" id="totalXPStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-smile"></i></div>
                        <div class="stat-label">Avg Mood</div>
                        <div class="stat-value" id="avgMoodStat">N/A</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-fire"></i></div>
                        <div class="stat-label">Streak</div>
                        <div class="stat-value" id="currentStreakStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-label">Tasks Done</div>
                        <div class="stat-value" id="tasksCompletedStat">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-bullseye"></i></div>
                        <div class="stat-label">Goals</div>
                        <div class="stat-value" id="goalsProgressStat">0/0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-book"></i></div>
                        <div class="stat-label">Journals</div>
                        <div class="stat-value" id="journalEntriesStat">0</div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="analytics-charts-grid">
                    <!-- Mood Trend Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-heart"></i> Mood Trend</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="moodTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- Completion Rate Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-tasks"></i> Completion Rate</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="completionRateChart"></canvas>
                        </div>
                    </div>

                    <!-- Category Performance Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-chart-pie"></i> Category Performance</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="categoryPerformanceChart"></canvas>
                        </div>
                    </div>

                    <!-- XP Progress Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-trophy"></i> XP Progress</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="xpProgressChart"></canvas>
                        </div>
                    </div>

                    <!-- Habit Streak Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-calendar-check"></i> Habit Streaks</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="habitStreakChart"></canvas>
                        </div>
                    </div>

                    <!-- Weekly Activity Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title"><i class="fas fa-chart-area"></i> Weekly Activity</div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="weeklyActivityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="insights-section">
                    <h2><i class="fas fa-lightbulb"></i> Smart Insights</h2>
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-icon">üèÜ</div>
                            <div class="insight-label">Best Category</div>
                            <div class="insight-value" id="bestCategoryInsight">---</div>
                            <div class="insight-description">Your top performing task category</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-icon">üìä</div>
                            <div class="insight-label">Avg Completion</div>
                            <div class="insight-value" id="avgCompletionInsight">---</div>
                            <div class="insight-description">Average daily completion rate</div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-icon">‚ö°</div>
                            <div class="insight-label">Productivity Score</div>
                            <div class="insight-value" id="productivityScoreInsight">---</div>
                            <div class="insight-description">Overall productivity rating</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('goals-view').innerHTML = `
                <div class="section">
                    <h2><i class="fas fa-bullseye"></i> Goals & Habits</h2>
                    
                    <!-- Goal Statistics -->
                    <div class="goal-stats">
                        <div class="goal-stat-card">
                            <div class="goal-stat-value" id="totalGoalsCount">0</div>
                            <div class="goal-stat-label">Total Goals</div>
                        </div>
                        <div class="goal-stat-card">
                            <div class="goal-stat-value" id="completedGoalsCount">0</div>
                            <div class="goal-stat-label">Completed</div>
                        </div>
                        <div class="goal-stat-card">
                            <div class="goal-stat-value" id="activeGoalsCount">0</div>
                            <div class="goal-stat-label">In Progress</div>
                        </div>
                        <div class="goal-stat-card">
                            <div class="goal-stat-value" id="successRateGoals">0%</div>
                            <div class="goal-stat-label">Success Rate</div>
                        </div>
                    </div>

                    <!-- Add Goal Button -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showAddGoalModal()"><i class="fas fa-plus"></i> Add New Goal</button>
                        <button class="btn btn-secondary" onclick="showAdvancedGoalModal()"><i class="fas fa-cog"></i> Advanced Goal</button>
                    </div>

                    <!-- Goal Filters -->
                    <div class="goal-filters">
                        <button class="filter-btn active" onclick="filterGoals('all', this)">All</button>
                        <button class="filter-btn" onclick="filterGoals('active', this)">Active</button>
                        <button class="filter-btn" onclick="filterGoals('completed', this)">Completed</button>
                        <button class="filter-btn" onclick="filterGoals('health', this)">üí™ Health</button>
                        <button class="filter-btn" onclick="filterGoals('productivity', this)">üöÄ Productivity</button>
                        <button class="filter-btn" onclick="filterGoals('learning', this)">üìö Learning</button>
                        <button class="filter-btn" onclick="filterGoals('personal', this)">‚ú® Personal</button>
                    </div>

                    <!-- Goals Container -->
                    <div class="goals-grid" id="goalsContainer"></div>
                </div>

                <!-- Bad Habits Breaking Section -->
                <div class="bad-habits-section">
                    <div class="bad-habits-header">
                        <h2><i class="fas fa-heart"></i> Quit Bad Habits</h2>
                        <button class="btn btn-primary" onclick="showAddBadHabitModal()"><i class="fas fa-plus"></i> Track a Bad Habit</button>
                    </div>
                    <div class="bad-habits-grid" id="badHabitsContainer"></div>
                </div>

                <!-- Advanced Habit Chain Section -->
                <div id="advancedHabitChain"></div>
            `;

            renderGoals();
            renderBadHabits();
            renderAdvancedHabitChain();

            document.getElementById('resources-view').innerHTML = `
                <div class="section">
                    <h2>üÜò Crisis Resources</h2>
                    <div class="resources-grid">
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-phone"></i></div>
                            <h3 class="resource-title">National Suicide Prevention Lifeline</h3>
                            <p class="resource-desc">Free, confidential support 24/7</p>
                            <div class="emergency-contact">üìû 1-800-273-8255</div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-message"></i></div>
                            <h3 class="resource-title">Crisis Text Line</h3>
                            <p class="resource-desc">Text HOME to 741741</p>
                            <div class="emergency-contact">üí¨ Text HOME to 741741</div>
                        </div>
                        <div class="resource-card">
                            <div class="resource-icon"><i class="fas fa-users"></i></div>
                            <h3 class="resource-title">SAMHSA National Helpline</h3>
                            <p class="resource-desc">Substance abuse & mental health services</p>
                            <div class="emergency-contact">üìû 1-800-662-4357</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('settings-view').innerHTML = ``;
            
            // Initialize settings
            if (typeof initSettings === 'function') {
                initSettings();
            }
        }
    </script>
</body>
</html>
